# Djiango的安装与项目创建
## Djiango安装
- Djiango安装命令: `pip install django`

## 项目创建
  - 打开终端，切换到工作目录
  - 执行命令创建目录`D:\[Python目录]\Scripts\django-admin.exe startproject [项目名称]` 或`Scripts`已加入环境变量：`django-admin.exe startproject [项目名称]`

## 默认项目文件
  - `manage.py` :项目管理、启动、创建App、数据管理程序
  - `[项目同名文件夹]` 
    - `init.py`
    - `asgi.py`:接收网络请求(同步)
    - `wsgi.py`:接收网络请求(异步)
    - `urls.py`:url和函数的对应关系
    - `settings.py`:项目配置
  
## APP
  - 创建App命令：`python manage.py startapp [App名称]`
  - APP目录文件
    - `admin.py`:Django默认提供了admin后台管理
    - `apps.py`:app启动类
    - `migrations`:数据库变更记录
    - `tests.py`:单元测试
    - `views.py`:函数
    - `models.py`:对数据库操作

## 基本使用
### 注册App 
- 复制`[App名称]`目录中`apps.py`的类名，如`TestappConfig`;在`settings.py`中`INSTALLED_APPS`中添加`[App名称.apps.[类名]]`，如`'testapp.apps.TestappConfig',`
### 编写URL和视图函数的对应关系
- 在`urls.py`中的`urlpatterns`字段中删除默认项`path('admin/', admin.site.urls)`
- 添加`path('index/', views.index),`(表示用户进入`index/`目录会进入`views.index`的函数，需要从`app目录`中导入`views`模块如`from testapp import views`)
### 编写视图函数
- 在`views.py`中添加需要的函数，如:`index`函数，并接受`request`
```python
from django.shortcuts import HttpResponse

def index(request):
    return HttpResponse("Hello, world")  # 视图中返回字符串
```
### 启动Django
- 启动命令：`python mange.py runserver`
- 访问: `http://127.0.0.1:8000/index/`

## 模板和静态文件
### 添加页面
- 在`urls.py`文件中`urlpatterns`字段中添加`path`函数及其参数，第一个参数为路由地址，第二个参数为`views.py`文件中的函数（链式）。如: `path('user/list/', views.user_list),`
- 在`views.py`中添加注册的函数，并接收`request`返回。如: `def user_list(request): `
### templates模板
- 访问时可以返回Html文件，在`views.py`文件中的函数里返回render函数及其参数，第一个参数为接受的值(一般是形参request)，第二个参数是Html的文件名(默认在app目录下的`templates文件夹`下寻找)。如: `return render(request, 'user_list.html')`
- 如果`settings.py`中`TEMPLATES`项的`DIRS`中有配置目录，则会优先在这个目录中寻找
### 静态文件
- Django中图片、CSS、JS等会被作为静态文件处理，一般文件放置于App目录的`static`目录下(需要创建)
- 引用静态文件可按Html语法引用，如: `<img src="/static/img/1.png" alt= "">`
- 推荐使用Django的语法引用，如: `<img src="{% static 'img/1.png' %}" alt="">`
- 使用推荐语法，更有利于文件夹变更（`setting.py`中`STATIC_URL`项），在使用推荐语法时，需要在html文件中加入语句: `{% load static %}`

## 模板语法
### 模板语法执行流程
1. 接收用户请求 → 访问`urls.py` → 访问`views.py` → 读取`templates`中含有模板语法的HTML文件
2. 渲染模板（执行`render`函数并替换数据）
3. 得到只包含HTML标签的字符串后返回给用户浏览器
### 变量与流程控制
- 在程序中定义的变量，通过`render`函数在第三个参数位置传递，需要字典格式传递;在html中引用时需要加双大括号和前后空格
- 可以传入列表，Html引用时使用`.`+序号（从0开始）索引
- 可以传入字典,可按照字典键进行索引
- 支持循环，语法为`{% for item in dict %} {% endfor %}`；索引字典时支持属性`.values`、`.keys`、`items`
- 支持嵌套列表或字典，引用时从外层开始索引,使用`.`链接
- 支持条件判断，语法为`{% if [条件表达式] %} {% endif %}`，支持`if-elif`和`if-else`

```python
def tpl(request):
  name = "Sancho"
  roles = ["管理员", "超级管理员", "会员"]
  user_info = {"name": "Sancho", "salary": 20000, "role": "会员"}

  return render(request, 'tpl.html', {
      "name": name,
      "roles": roles,
      "user_info": user_info
  })
```

```html
<div>{{ name }}</div>  <!-- 传入变量 -->
<div>{{ roles }}</div>  <!-- 传入列表 -->
<div>{{ roles.0 }}</div>  <!-- 列表索引 -->
<div>{{ user_info }}</div>  <!-- 传入字典 -->
<div>{{ user_info.salary }}</div>  <!-- 字典索引 -->

<hr/>

<div>  <!-- 列表循环 -->
    {% for item in roles %}
        <span>{{ item }}</span>
    {% endfor %}
</div>
<ul>  <!-- 字典循环 -->
    {% for k,v in user_info.items %}
        <li>{{ k }} == {{ v }}</li>
    {% endfor %}
</ul>

<hr/>

{% if name == "Sancho" %}  <!-- 条件判断 -->
  <h3> ✔ </h3>
{% elif name == "Leo" %}
  <h3> ○ </h3>
{% else %}
  <h3> ✖ </h3>
{% endif %}

```

## 请求和响应
### 获取请求
- `views.py`中函数的参数是接收用户发送的请求相关数据
- `request.method`获取请求方式
- `request.GET`获取GET请求中url中传递的值
- `request.POST`获取POST请求中请求体提交的数据
- `redirect`函数可以返回一个重定向响应，第一个参数为重定向url
- 用户需要提交表单时需要在html表单中添加`{% csrf_token %}`
